---
// menu-principal/index.astro
import MenuPrincipal from "@components/menu-principal/menu.astro";
import MenuInfo from "./menu-info.astro";
import MenuMode from "./menu-mode.astro";
import MenuSearch from "./menu-search.astro";
import MenuHome from "./menu-home.astro";
import MenuLogout from "./menu-logout.astro";
import MenuLogin from "./menu-login.astro";
import MenuPerfil from "./menu-perfil.astro";
import pb from "../../utils/matterjs/pocketbase.js";

let user = null;

// Esto solo se ejecutará en el cliente
---
<div id="menu-dinamico">
  <MenuPrincipal client:load>
    <MenuInfo />
    <MenuMode />
    <MenuSearch />

    <MenuHome user={user} />

    {user ? (
      <>
        <MenuPerfil user={user} />
        <MenuLogout user={user} />
      </>
    ) : (
      <MenuLogin />
    )}
  </MenuPrincipal>
</div>

<script type="module">
  import pb from '../../utils/matterjs/pocketbase.js';

  // Solo se ejecuta en el cliente
  let user = null;

  try {
    pb.authStore.loadFromCookie(document.cookie);
    if (pb.authStore.isValid) {
      user = pb.authStore.model;
      document.querySelector("#menu-dinamico")?.setAttribute("data-user", user.username);
    }
  } catch (err) {
    console.error("Error al obtener sesión:", err);
  }
</script>
